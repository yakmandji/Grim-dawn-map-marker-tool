<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Grim Dawn Map Marker Tool ‚Äî v6.3</title>
  <link rel="stylesheet" href="style.css" />
</head>
<body>
  <div class="app">
    <header>
      <div class="title">üó∫Ô∏è Grim Dawn Map Marker Tool ‚Äî v6.3</div>
      <button id="toolPan" class="small">üñêÔ∏è Pan</button>
      <label class="chip"><input id="lockAll" type="checkbox" /> Lock markers</label>
      <div class="sep"></div>
      <select id="profileSelect" title="Profils" class="active"><option value="">(profil)</option></select>
      <button id="newProfile" class="small">Create new map</button>
      <button id="renProfile" class="small">Rename map</button>
      <button id="delProfile" class="small danger">Delete map</button>
      <div class="sep"></div><button id="exportAllBtn" class="small">Save</button>
      <button id="importReplaceBtn" class="small">Open</button>
      <span id="saveStatus" style="margin-left:8px;">‚óè Saved</span>
    </header>

    <aside class="sidebar">
      <div class="section">
        <h3>New marker</h3>
        <div class="row">
          <input id="newLabel" type="text" placeholder="Name / note" />
        </div>
        <div class="row">
          <select id="newCategory">
            <option>General</option>
            <option>Quest</option>
            <option>Boss</option>
            <option>Loot</option>
            <option>Waypoint</option>
            <option>Donjon</option>
            <option>NPC</option>
          </select>
          <input id="newColor" type="color" value="#78f1c2" style="flex:0 0 auto" />
          <label style="flex:0 0 auto">
            <input id="newCompleted" type="checkbox" /> Done
          </label>
          <button id="toolAdd" class="small">üìç Add</button>
        </div>
      </div>

      <div class="section" style="min-height:180px;display:flex;flex-direction:column;gap:8px;min-height:0;">
        <h3 class="m0">Markers (<span id="count">0</span>)</h3>
        <div id="list" class="list"></div>
      </div>

      <div class="section" id="admin-section">
        <h3>Admin section</h3>
        <div class="row" style="gap:8px">
          <button id="clearProfile" class="small danger">Empty profile</button>
          <button id="clearSession" class="small danger">Reset all</button>
        </div>
      </div>

      <div class="section" id="admin-section">
        <h3>Only for image map Update</h3>
        <div class="row" style="gap:8px; flex-direction: column;">
          <p class="small">
            For futur update map, if you want to keep you markers<br>
            Load a new image to replace the current map background.
          </p>
        </div>
        <div class="row">
          <input id="mapFile" type="file" accept="image/*" />
        </div>       
      </div>   
      <a id="helpToggle">‚ùîHow to use</a>
    </aside>

    <div class="helpPopup" id="helpSection" style="display:none">
      <button class="closeHelp">√ó</button>
      <h3>Help</h3>
      <ul>
        <li>Choose a map from the list in the header (main or DLC)</li>
        <li>Add markers üìç</li>
        <li><b>Remember to save after making changes, so you don‚Äôt lose them</b><br>
          <i>(Firefox users: the map will be downloaded each time you save. To overwrite the same file, use Chrome / Edge / Brave.)</i>
        </li>
        <li>Reopen your saved file next time</li>
      </ul>
        <p class="small"><br> <b>For future map updates, if you want to keep your markers:</b><br>
        click <a id="downloadMaps"><b>Download all maps</b></a> to get all the updated map images.
       Then extract them and load the desired image into your current map profile.<br>
        For a brand-new map, create a new map first, then upload the image file.<br>
        If you want to start from scratch, you don‚Äôt need to do anything. Just save to your JSON file locally.
        </p>
    </div>

    <main class="mapWrap">
      <div id="mapViewport" class="mapViewport">
        <div id="mapInner" class="mapInner">
          <img id="mapImg" alt="Map" draggable="false" />
        </div>
      </div>
      <div class="floating">
        <span class="chip" id="zoomReadout">100%</span>
        <span class="chip" id="cursorReadout">x: ‚Äì, y: ‚Äì</span>
      </div>
    </main>
  </div>

  <input id="importInput" type="file" accept="application/json" hidden />

  <template id="tplItem">
    <div class="listItem">
      <div class="pin" data-pin></div>
      <div>
        <div class="row" style="gap:6px">
          <input data-label type="text" placeholder="marker name" />
         <button class="marker-save" title="Save name">üíæ</button>
         <button data-center class="marker-center" title="Center on map">
             <svg viewBox="0 0 24 24" width="18" height="18" fill="none" stroke="white" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
              <circle cx="12" cy="12" r="3"></circle>
              <circle cx="12" cy="12" r="10"></circle>
              <line x1="12" y1="2" x2="12" y2="6"></line>
              <line x1="12" y1="18" x2="12" y2="22"></line>
              <line x1="2" y1="12" x2="6" y2="12"></line>
              <line x1="18" y1="12" x2="22" y2="12"></line>
            </svg>
         </button>
        </div>
        <div class="row" style="gap:6px;margin-top:6px">
          <select data-cat>
            <option>General</option>
            <option>Quest</option>
            <option>Boss</option>
            <option>Loot</option>
            <option>Waypoint</option>
            <option>Donjon</option>
            <option>NPC</option>
          </select>
          <input data-color type="color" style="flex:0 0 36px" />
          <label style="flex:0 0 auto">
            <input data-done type="checkbox" /> Done
          </label>
          <button data-delete class="small danger">Suppr</button>
        </div>
      </div>

    </div>
  </template>
  <div id="toastContainer"></div>

  <script src="script.js"></script>
</body>
</html>
